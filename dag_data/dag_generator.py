from dag_data.utils import *
import numpy as np
import networkx as nx
import random
from copy import deepcopy
from dag_data.dag_dict import dag_data_dict


class SetWithCount(object):
    """
    allow duplication in set
    """
    def __init__(self):
        self.set = {}

    def __contains__(self, item):
        return item in self.set

    def add(self, item):
        if item in self.set:
            self.set[item] += 1
        else:
            self.set[item] = 1

    def clear(self):
        self.set.clear()

    def remove(self, item):
        self.set[item] -= 1
        if self.set[item] == 0:
            del self.set[item]

train1 = [([('100g', '5'), ('100g', '1'), ('100g', '16'), ('100g', '11'), ('100g', '15')], 45), ([('100g', '20'), ('100g', '7'), ('100g', '2'), ('100g', '8'), ('100g', '19')], 65), ([('100g', '18'), ('100g', '7'), ('100g', '6'), ('100g', '6'), ('100g', '7')], 38), ([('100g', '3'), ('100g', '1'), ('100g', '5'), ('100g', '4'), ('100g', '11')], 41), ([('100g', '9'), ('100g', '9'), ('100g', '21'), ('100g', '5'), ('100g', '4')], 64), ([('100g', '13'), ('100g', '6'), ('100g', '1'), ('100g', '21'), ('100g', '16')], 38), ([('100g', '17'), ('100g', '10'), ('100g', '1'), ('100g', '2'), ('100g', '18')], 45), ([('100g', '15'), ('100g', '20'), ('100g', '21'), ('100g', '3'), ('100g', '4')], 47), ([('100g', '17'), ('100g', '15'), ('100g', '20'), ('100g', '16'), ('100g', '9')], 48), ([('100g', '18'), ('100g', '6'), ('100g', '19'), ('100g', '8'), ('100g', '10')], 41), ([('100g', '16'), ('100g', '15'), ('100g', '13'), ('100g', '6'), ('100g', '1')], 29), ([('100g', '22'), ('100g', '20'), ('100g', '15'), ('100g', '6'), ('100g', '11')], 40), ([('100g', '19'), ('100g', '20'), ('100g', '15'), ('100g', '15'), ('100g', '19')], 34), ([('100g', '10'), ('100g', '8'), ('100g', '15'), ('100g', '17'), ('100g', '5')], 54), ([('100g', '10'), ('100g', '16'), ('100g', '21'), ('100g', '19'), ('100g', '17')], 44), ([('100g', '11'), ('100g', '10'), ('100g', '15'), ('100g', '15'), ('100g', '20')], 46), ([('100g', '22'), ('100g', '13'), ('100g', '18'), ('100g', '1'), ('100g', '4')], 33), ([('100g', '7'), ('100g', '5'), ('100g', '12'), ('100g', '1'), ('100g', '1')], 41), ([('100g','18'), ('100g', '5'), ('100g', '14'), ('100g', '2'), ('100g', '10')], 53), ([('100g', '20'), ('100g', '12'), ('100g', '8'), ('100g', '17'), ('100g', '9')], 56), ([('100g', '10'), ('100g', '6'), ('100g', '18'), ('100g', '2'),('100g', '7')], 50), ([('100g', '1'), ('100g', '17'), ('100g', '22'), ('100g', '21'), ('100g', '5')], 48), ([('100g', '21'), ('100g', '1'), ('100g', '22'), ('100g', '9'), ('100g', '9')], 56), ([('100g', '1'), ('100g', '2'), ('100g', '3'), ('100g', '20'), ('100g', '12')], 46), ([('100g', '11'), ('100g', '10'), ('100g', '4'), ('100g', '4'), ('100g', '7')], 45), ([('100g', '7'), ('100g', '1'), ('100g', '16'), ('100g', '17'), ('100g', '3')], 38), ([('100g', '18'), ('100g', '18'), ('100g', '22'), ('100g', '20'), ('100g', '14')], 40), ([('100g', '22'), ('100g', '11'), ('100g', '1'), ('100g', '8'), ('100g', '17')], 47), ([('100g', '5'), ('100g', '17'), ('100g', '20'), ('100g', '1'), ('100g', '19')], 40), ([('100g', '15'), ('100g', '16'), ('100g', '4'), ('100g', '14'), ('100g', '16')], 35), ([('100g', '6'), ('100g', '6'), ('100g', '14'), ('100g', '9'), ('100g', '9')], 36), ([('100g', '11'), ('100g', '12'), ('100g', '5'), ('100g', '19'), ('100g', '2')], 53), ([('100g', '11'), ('100g', '1'), ('100g', '2'), ('100g', '20'), ('100g', '12')], 51), ([('100g', '9'), ('100g', '19'), ('100g', '16'), ('100g', '6'), ('100g', '18')], 37), ([('100g', '12'), ('100g', '8'), ('100g', '17'), ('100g', '14'), ('100g', '8')], 52), ([('100g', '8'), ('100g', '17'), ('100g', '22'), ('100g', '14'), ('100g', '15')], 43), ([('100g', '10'), ('100g', '6'), ('100g', '7'), ('100g', '20'), ('100g', '16')], 45), ([('100g', '10'), ('100g', '22'), ('100g', '22'), ('100g', '7'), ('100g', '12')], 44), ([('100g', '7'), ('100g', '13'), ('100g', '16'), ('100g', '2'), ('100g', '1')], 51), ([('100g', '7'), ('100g', '18'), ('100g', '21'), ('100g', '7'), ('100g', '3')], 56), ([('100g', '5'), ('100g', '17'), ('100g', '15'), ('100g', '3'), ('100g', '21')], 49), ([('100g', '3'), ('100g', '2'), ('100g', '3'), ('100g', '2'),('100g', '22')], 56), ([('100g', '5'), ('100g', '5'), ('100g', '7'), ('100g', '15'), ('100g', '17')], 54), ([('100g', '13'), ('100g', '1'), ('100g', '5'), ('100g', '11'), ('100g', '3')], 42), ([('100g', '19'), ('100g', '5'),('100g', '18'), ('100g', '1'), ('100g', '5')], 44), ([('100g', '12'), ('100g', '21'), ('100g', '7'), ('100g', '2'), ('100g', '14')], 57), ([('100g', '19'), ('100g', '15'), ('100g', '8'), ('100g', '2'), ('100g', '17')], 53), ([('100g', '17'), ('100g', '15'), ('100g', '20'), ('100g', '7'), ('100g', '14')], 42), ([('100g', '17'), ('100g', '17'), ('100g', '9'), ('100g', '6'), ('100g', '11')], 39), ([('100g', '21'), ('100g', '8'), ('100g', '10'), ('100g', '2'), ('100g', '17')], 67)]
test1 = [([('100g', '4'), ('100g', '1'), ('100g', '2'), ('100g', '18'), ('100g', '11')], 47), ([('100g', '9'), ('100g', '22'), ('100g', '5'), ('100g', '3'), ('100g', '14')], 46), ([('100g', '10'), ('100g', '4'), ('100g', '12'), ('100g', '14'), ('100g', '8')], 43), ([('100g', '17'), ('100g', '11'), ('100g', '6'), ('100g', '5'), ('100g', '10')], 42), ([('100g', '19'), ('100g', '6'), ('100g', '14'), ('100g', '16'), ('100g', '12')], 25), ([('100g', '5'), ('100g', '4'), ('100g', '12'), ('100g', '3'), ('100g', '14')], 36), ([('100g', '22'), ('100g', '3'), ('100g', '15'), ('100g', '16'), ('100g', '12')], 36), ([('100g', '15'), ('100g', '12'), ('100g', '7'), ('100g', '12'), ('100g', '16')], 41), ([('100g', '12'), ('100g', '2'), ('100g', '7'), ('100g', '5'), ('100g', '6')], 53), ([('100g', '17'), ('100g', '7'), ('100g', '2'), ('100g', '10'), ('100g', '20')], 58)]
train2 = [([('100g', '7'), ('100g', '22'), ('100g', '5'), ('100g', '3'), ('100g', '1'), ('100g', '21'), ('100g', '3'), ('100g', '13'), ('100g', '1'), ('100g', '14')], 82), ([('100g', '13'), ('100g', '15'), ('100g', '20'), ('100g', '14'), ('100g', '1'), ('100g', '18'), ('100g', '7'), ('100g', '20'), ('100g', '1'), ('100g', '8')], 89), ([('100g', '8'), ('100g', '7'), ('100g', '5'), ('100g', '15'), ('100g', '21'), ('100g', '10'), ('100g', '1'), ('100g', '7'), ('100g', '11'), ('100g', '22')], 113), ([('100g', '7'), ('100g', '5'), ('100g', '14'), ('100g', '6'), ('100g', '17'), ('100g', '8'), ('100g', '6'), ('100g', '22'), ('100g', '9'), ('100g', '3')], 87), ([('100g', '8'), ('100g', '5'), ('100g', '15'), ('100g', '11'), ('100g', '10'), ('100g', '15'), ('100g', '18'), ('100g', '19'), ('100g', '11'), ('100g', '9')], 103), ([('100g', '17'), ('100g', '21'), ('100g', '5'), ('100g', '2'), ('100g', '9'), ('100g', '16'), ('100g', '2'), ('100g', '15'), ('100g', '10'), ('100g', '17')], 117), ([('100g', '17'), ('100g', '10'), ('100g', '8'), ('100g', '8'), ('100g', '2'), ('100g', '21'), ('100g', '10'), ('100g', '9'),('100g', '17'), ('100g', '12')], 120), ([('100g', '14'), ('100g', '2'), ('100g', '15'), ('100g', '15'), ('100g', '7'), ('100g', '3'), ('100g', '15'), ('100g', '10'), ('100g', '7'), ('100g', '1')], 88), ([('100g', '14'), ('100g', '4'), ('100g', '1'), ('100g', '2'), ('100g', '12'), ('100g', '14'), ('100g', '16'), ('100g', '18'), ('100g', '8'), ('100g', '11')], 88), ([('100g', '11'), ('100g', '13'), ('100g', '4'), ('100g', '17'), ('100g', '7'), ('100g', '13'), ('100g', '1'), ('100g', '16'), ('100g', '11'), ('100g', '2')], 92), ([('100g', '16'), ('100g', '11'), ('100g', '3'), ('100g', '14'), ('100g', '20'), ('100g', '12'), ('100g', '11'), ('100g', '15'), ('100g', '2'), ('100g', '20')], 96), ([('100g', '20'), ('100g', '22'), ('100g', '22'), ('100g', '10'), ('100g', '12'), ('100g', '13'), ('100g', '2'), ('100g', '10'), ('100g', '14'), ('100g', '21')], 97), ([('100g', '19'), ('100g', '17'), ('100g', '4'), ('100g', '18'), ('100g', '11'), ('100g', '11'), ('100g', '11'), ('100g', '4'), ('100g', '16'), ('100g', '10')], 81), ([('100g', '17'), ('100g', '12'), ('100g', '21'), ('100g', '18'), ('100g', '4'), ('100g', '13'), ('100g', '10'), ('100g', '7'), ('100g', '16'), ('100g', '16')], 89), ([('100g', '5'), ('100g', '20'), ('100g', '6'), ('100g', '12'), ('100g', '11'), ('100g', '22'), ('100g', '9'), ('100g', '17'), ('100g', '17'), ('100g', '5')], 93), ([('100g', '4'), ('100g', '20'), ('100g', '8'), ('100g', '17'), ('100g', '6'), ('100g', '19'), ('100g', '12'), ('100g', '22'), ('100g', '8'), ('100g', '21')], 96), ([('100g', '1'), ('100g', '3'), ('100g', '20'), ('100g', '11'), ('100g', '18'), ('100g', '10'), ('100g', '16'), ('100g', '16'), ('100g', '11'), ('100g', '17')], 85), ([('100g', '11'), ('100g', '16'), ('100g', '16'), ('100g', '15'), ('100g', '9'), ('100g', '16'), ('100g', '20'), ('100g', '7'), ('100g', '3'), ('100g', '20')], 102), ([('100g', '17'), ('100g', '9'), ('100g', '5'), ('100g', '3'), ('100g', '12'), ('100g', '10'), ('100g', '1'), ('100g', '3'), ('100g', '13'), ('100g', '20')], 84), ([('100g', '8'), ('100g', '21'), ('100g', '1'), ('100g', '7'), ('100g', '16'), ('100g', '4'), ('100g', '15'), ('100g', '3'), ('100g', '5'), ('100g', '17')], 99), ([('100g', '5'), ('100g', '5'), ('100g', '5'), ('100g', '11'), ('100g', '5'), ('100g', '7'), ('100g', '2'), ('100g', '2'), ('100g', '2'), ('100g', '20')], 146), ([('100g', '6'), ('100g', '7'), ('100g', '17'), ('100g', '10'), ('100g', '21'), ('100g', '19'), ('100g', '1'), ('100g', '6'), ('100g', '21'), ('100g', '5')], 86), ([('100g', '1'), ('100g', '5'), ('100g', '17'), ('100g', '3'), ('100g', '3'), ('100g', '6'), ('100g', '22'), ('100g', '9'), ('100g', '3'), ('100g', '4')], 72), ([('100g', '19'), ('100g', '19'), ('100g', '17'), ('100g', '1'), ('100g', '19'), ('100g', '17'), ('100g', '12'), ('100g', '19'), ('100g', '5'), ('100g', '6')], 54), ([('100g', '3'), ('100g', '11'), ('100g', '9'), ('100g', '1'), ('100g', '2'), ('100g', '15'), ('100g', '5'), ('100g', '6'), ('100g', '9'), ('100g', '12')], 96), ([('100g', '12'), ('100g', '8'), ('100g', '21'), ('100g', '22'), ('100g', '21'), ('100g', '19'), ('100g', '3'), ('100g', '10'), ('100g', '7'), ('100g', '4')], 102), ([('100g', '17'), ('100g', '9'), ('100g', '20'), ('100g', '8'), ('100g', '20'), ('100g', '20'), ('100g', '12'), ('100g', '4'), ('100g', '5'), ('100g', '7')], 113), ([('100g', '21'), ('100g', '20'), ('100g', '10'), ('100g', '5'), ('100g', '9'), ('100g', '11'), ('100g', '6'), ('100g', '6'), ('100g', '8'), ('100g', '7')], 111), ([('100g', '7'), ('100g', '5'), ('100g', '19'), ('100g', '14'), ('100g', '13'), ('100g', '7'), ('100g', '3'), ('100g', '2'), ('100g', '18'), ('100g', '19')], 91), ([('100g', '20'), ('100g', '15'), ('100g', '11'), ('100g', '4'), ('100g', '14'), ('100g', '1'), ('100g', '14'), ('100g', '20'), ('100g', '12'), ('100g', '2')], 84), ([('100g', '1'), ('100g', '13'), ('100g', '5'), ('100g', '7'), ('100g', '8'), ('100g', '1'), ('100g', '22'), ('100g', '11'), ('100g', '8'), ('100g', '7')], 110), ([('100g', '17'), ('100g', '4'), ('100g', '4'), ('100g', '3'), ('100g', '3'),('100g', '8'), ('100g', '18'), ('100g', '18'), ('100g', '17'), ('100g', '20')], 82), ([('100g', '10'), ('100g', '6'), ('100g', '13'), ('100g', '18'), ('100g', '1'), ('100g', '1'), ('100g', '15'), ('100g', '10'), ('100g', '11'), ('100g', '14')], 65), ([('100g', '12'), ('100g', '14'), ('100g', '10'), ('100g', '5'), ('100g', '21'), ('100g', '20'), ('100g', '20'), ('100g', '10'), ('100g', '7'), ('100g', '18')], 103), ([('100g', '9'), ('100g', '8'), ('100g', '7'), ('100g', '9'), ('100g', '6'), ('100g', '10'), ('100g', '15'), ('100g', '16'), ('100g', '4'), ('100g', '18')], 100), ([('100g', '22'), ('100g', '17'), ('100g', '22'), ('100g', '15'), ('100g', '7'), ('100g', '14'), ('100g', '13'), ('100g', '19'), ('100g', '6'), ('100g', '12')], 65), ([('100g', '10'), ('100g', '5'), ('100g', '2'), ('100g', '5'), ('100g', '21'), ('100g', '1'), ('100g', '2'), ('100g', '4'), ('100g', '13'), ('100g', '9')], 120), ([('100g', '15'), ('100g', '17'), ('100g', '16'), ('100g', '8'), ('100g', '14'), ('100g', '11'), ('100g', '4'), ('100g', '6'), ('100g', '6'), ('100g', '19')], 69), ([('100g', '3'), ('100g', '5'), ('100g', '21'), ('100g', '17'), ('100g', '15'), ('100g', '10'), ('100g', '7'), ('100g', '12'), ('100g', '5'), ('100g', '7')], 104), ([('100g', '2'), ('100g', '14'), ('100g', '20'), ('100g', '1'), ('100g', '15'), ('100g', '13'), ('100g', '16'), ('100g', '3'), ('100g', '15'), ('100g', '11')], 85), ([('100g', '9'), ('100g', '18'), ('100g', '17'), ('100g', '3'), ('100g', '3'), ('100g', '16'), ('100g', '22'), ('100g', '20'), ('100g', '8'), ('100g', '8')], 105), ([('100g', '1'), ('100g', '6'), ('100g', '19'), ('100g', '3'), ('100g', '7'), ('100g', '5'), ('100g', '4'), ('100g', '11'), ('100g', '6'), ('100g', '11')], 73), ([('100g', '10'), ('100g', '2'), ('100g', '4'), ('100g', '5'), ('100g', '2'), ('100g', '8'), ('100g', '19'), ('100g', '8'), ('100g', '19'), ('100g', '9')], 123), ([('100g', '8'), ('100g', '12'), ('100g', '4'), ('100g', '6'), ('100g', '16'), ('100g', '7'), ('100g', '12'), ('100g', '10'), ('100g', '15'), ('100g', '3')], 82), ([('100g', '2'), ('100g', '17'), ('100g', '14'), ('100g', '20'), ('100g', '6'), ('100g', '12'), ('100g', '10'), ('100g', '11'), ('100g', '16'), ('100g', '9')], 91), ([('100g', '18'), ('100g', '20'),('100g', '2'), ('100g', '17'), ('100g', '4'), ('100g', '3'), ('100g', '11'), ('100g', '18'), ('100g', '8'), ('100g', '17')], 99), ([('100g', '1'), ('100g', '3'), ('100g', '17'), ('100g', '18'), ('100g', '20'), ('100g', '22'), ('100g', '9'), ('100g', '11'), ('100g', '3'), ('100g', '4')], 81), ([('100g', '18'), ('100g', '13'), ('100g', '11'), ('100g', '7'), ('100g', '21'), ('100g', '17'), ('100g', '3'), ('100g', '15'), ('100g', '20'), ('100g', '3')], 92), ([('100g', '15'), ('100g', '17'), ('100g', '8'), ('100g', '1'), ('100g', '1'), ('100g', '20'), ('100g', '12'), ('100g', '3'), ('100g', '7'), ('100g', '14')], 80), ([('100g', '9'), ('100g', '1'), ('100g', '14'), ('100g', '18'), ('100g', '10'), ('100g', '13'), ('100g', '20'), ('100g', '16'), ('100g', '12'), ('100g', '12')], 79)]
test2 = [([('100g', '3'), ('100g', '20'), ('100g', '14'), ('100g', '2'), ('100g', '19'), ('100g', '16'), ('100g', '21'), ('100g', '20'), ('100g', '16'), ('100g', '21')], 106),
          ([('100g', '17'), ('100g', '4'), ('100g', '5'), ('100g', '2'), ('100g', '13'), ('100g', '15'), ('100g', '8'), ('100g', '13'), ('100g', '11'), ('100g', '15')], 101),
          ([('100g', '20'), ('100g', '19'), ('100g', '21'), ('100g', '14'), ('100g', '5'), ('100g', '14'), ('100g', '15'), ('100g', '15'), ('100g', '17'), ('100g', '4')], 80),
          ([('100g', '3'), ('100g', '1'), ('100g', '20'), ('100g', '4'), ('100g', '21'), ('100g', '3'), ('100g', '18'), ('100g', '22'), ('100g', '13'), ('100g', '7')], 86),
          ([('100g', '5'), ('100g', '17'), ('100g', '9'), ('100g', '9'), ('100g', '13'), ('100g', '3'), ('100g', '21'), ('100g', '21'), ('100g', '8'), ('100g', '9')], 125),
          ([('100g', '8'), ('100g', '4'), ('100g', '10'), ('100g', '11'), ('100g', '22'), ('100g', '7'), ('100g', '9'), ('100g', '18'), ('100g', '9'), ('100g', '8')], 119),
          ([('100g', '14'), ('100g', '3'), ('100g', '4'), ('100g', '4'), ('100g', '13'), ('100g', '2'), ('100g', '21'), ('100g', '8'), ('100g', '10'), ('100g', '19')], 94),
          ([('100g', '8'), ('100g', '19'), ('100g', '17'), ('100g', '12'), ('100g', '5'), ('100g', '5'), ('100g', '22'), ('100g', '17'), ('100g', '9'), ('100g', '4')], 96),
          ([('100g', '2'), ('100g', '15'), ('100g', '6'), ('100g', '21'), ('100g', '7'), ('100g', '14'), ('100g', '10'), ('100g', '17'), ('100g', '5'), ('100g', '9')], 103),
          ([('100g', '6'), ('100g', '21'), ('100g', '16'), ('100g', '21'), ('100g', '14'),('100g', '2'), ('100g', '3'), ('100g', '4'), ('100g', '16'), ('100g', '9')], 100)]
train3 = [([('100g', '15'), ('100g', '16'), ('100g', '12'), ('100g', '14'), ('100g', '6'), ('100g', '20'), ('100g', '7'), ('100g', '9'), ('100g', '3'), ('100g', '9'), ('100g', '5'), ('100g', '18'), ('100g', '7'), ('100g', '5'), ('100g', '17')], 142), ([('100g', '11'), ('100g', '2'), ('100g', '21'), ('100g', '2'), ('100g', '18'), ('100g', '4'), ('100g', '11'), ('100g', '18'), ('100g', '20'), ('100g', '13'), ('100g', '1'), ('100g', '11'), ('100g', '6'), ('100g', '9'), ('100g', '3')], 152), ([('100g', '18'), ('100g', '8'), ('100g', '5'), ('100g', '19'), ('100g', '18'), ('100g', '8'), ('100g', '2'), ('100g', '20'), ('100g', '2'), ('100g', '9'), ('100g', '4'), ('100g', '18'), ('100g', '5'), ('100g', '7'), ('100g', '18')], 181), ([('100g', '18'), ('100g', '8'), ('100g', '18'), ('100g', '20'), ('100g', '20'), ('100g', '14'), ('100g', '2'), ('100g', '16'), ('100g', '11'), ('100g', '9'), ('100g', '21'), ('100g', '12'), ('100g', '18'), ('100g', '19'), ('100g', '20')], 160), ([('100g', '5'), ('100g', '13'), ('100g', '6'), ('100g', '13'), ('100g', '12'), ('100g', '2'), ('100g', '17'), ('100g', '7'), ('100g', '2'), ('100g', '21'), ('100g', '15'), ('100g', '21'), ('100g', '4'), ('100g', '2'), ('100g', '18')], 162), ([('100g', '15'), ('100g','8'), ('100g', '11'), ('100g', '17'), ('100g', '1'), ('100g', '15'), ('100g', '17'), ('100g', '10'), ('100g', '10'), ('100g', '12'), ('100g', '22'), ('100g', '12'), ('100g', '6'), ('100g', '19'), ('100g', '9')], 117), ([('100g', '1'), ('100g', '14'),('100g', '7'), ('100g', '14'), ('100g', '5'), ('100g', '13'), ('100g', '18'), ('100g', '13'), ('100g', '11'), ('100g', '3'), ('100g', '20'), ('100g', '14'), ('100g', '8'), ('100g', '17'), ('100g', '11')], 129), ([('100g', '3'), ('100g', '16'), ('100g', '15'), ('100g', '14'), ('100g', '12'), ('100g', '22'), ('100g', '4'), ('100g', '6'), ('100g', '9'), ('100g', '1'), ('100g', '9'), ('100g', '4'), ('100g', '11'), ('100g', '6'), ('100g', '5')], 113), ([('100g', '4'), ('100g', '3'), ('100g', '21'), ('100g', '10'), ('100g', '22'), ('100g', '18'), ('100g', '19'), ('100g', '2'), ('100g', '17'), ('100g', '11'), ('100g', '20'), ('100g', '19'), ('100g', '7'), ('100g', '16'), ('100g', '5')], 144), ([('100g', '9'), ('100g', '19'), ('100g', '13'), ('100g','13'), ('100g', '8'), ('100g', '22'), ('100g', '1'), ('100g', '17'), ('100g', '1'), ('100g', '4'), ('100g', '21'), ('100g', '3'), ('100g', '7'), ('100g', '2'), ('100g', '1')], 135), ([('100g', '9'), ('100g', '4'), ('100g', '3'), ('100g', '1'), ('100g', '8'), ('100g', '8'), ('100g', '11'), ('100g', '22'), ('100g', '8'), ('100g', '1'), ('100g', '9'), ('100g', '18'), ('100g', '1'), ('100g', '12'), ('100g', '10')], 148), ([('100g', '14'), ('100g', '4'), ('100g', '10'), ('100g', '15'), ('100g', '18'),('100g', '21'), ('100g', '13'), ('100g', '7'), ('100g', '13'), ('100g', '19'), ('100g', '19'), ('100g', '22'), ('100g', '5'), ('100g', '3'), ('100g', '16')], 122), ([('100g', '12'), ('100g', '1'), ('100g', '19'), ('100g', '16'), ('100g', '5'), ('100g', '4'), ('100g', '22'), ('100g', '19'), ('100g', '22'), ('100g', '10'), ('100g', '16'), ('100g', '3'), ('100g', '4'), ('100g', '9'), ('100g', '16')], 116), ([('100g', '7'), ('100g', '16'), ('100g', '11'), ('100g', '13'), ('100g', '7'), ('100g', '4'),('100g', '10'), ('100g', '7'), ('100g', '15'), ('100g', '22'), ('100g', '5'), ('100g', '22'), ('100g', '12'), ('100g', '5'), ('100g', '3')], 144), ([('100g', '7'), ('100g', '2'), ('100g', '1'), ('100g', '7'), ('100g', '8'), ('100g', '5'), ('100g', '4'), ('100g', '13'), ('100g', '9'), ('100g', '21'), ('100g', '2'), ('100g', '22'), ('100g', '16'), ('100g', '6'), ('100g', '1')], 164), ([('100g', '15'), ('100g', '7'), ('100g', '8'), ('100g', '12'), ('100g', '4'), ('100g', '13'), ('100g', '6'), ('100g', '18'), ('100g', '10'), ('100g', '18'), ('100g', '4'), ('100g', '5'), ('100g', '20'), ('100g', '20'), ('100g', '1')], 132), ([('100g', '22'), ('100g', '12'), ('100g', '1'), ('100g', '12'), ('100g', '5'), ('100g', '7'), ('100g', '19'), ('100g', '7'),('100g', '6'), ('100g', '11'), ('100g', '7'), ('100g', '13'), ('100g', '18'), ('100g', '9'), ('100g', '9')], 137), ([('100g', '6'), ('100g', '4'), ('100g', '6'), ('100g', '18'), ('100g', '16'), ('100g', '10'), ('100g', '17'), ('100g', '20'), ('100g','12'), ('100g', '5'), ('100g', '20'), ('100g', '21'), ('100g', '7'), ('100g', '19'), ('100g', '22')], 127), ([('100g', '7'), ('100g', '1'), ('100g', '13'), ('100g', '4'), ('100g', '19'), ('100g', '20'), ('100g', '6'), ('100g', '9'), ('100g', '18'), ('100g', '20'), ('100g', '13'), ('100g', '7'), ('100g', '20'), ('100g', '11'), ('100g', '11')], 136), ([('100g', '7'), ('100g', '2'), ('100g', '5'), ('100g', '11'), ('100g', '3'), ('100g', '15'), ('100g', '19'), ('100g', '9'), ('100g', '8'), ('100g', '15'), ('100g', '14'), ('100g', '13'), ('100g', '12'), ('100g', '19'), ('100g', '22')], 141), ([('100g', '13'), ('100g', '21'), ('100g', '5'), ('100g', '19'), ('100g', '8'), ('100g', '19'), ('100g', '17'), ('100g', '5'), ('100g', '2'), ('100g', '13'), ('100g', '9'), ('100g', '13'), ('100g', '18'), ('100g', '10'), ('100g', '21')], 162), ([('100g', '16'), ('100g', '19'), ('100g', '14'), ('100g', '11'), ('100g', '19'), ('100g', '15'), ('100g', '17'), ('100g', '13'), ('100g', '5'), ('100g', '17'), ('100g', '15'), ('100g', '17'), ('100g', '15'), ('100g', '5'), ('100g', '2')], 124), ([('100g', '20'), ('100g', '12'), ('100g', '8'), ('100g', '10'), ('100g', '6'), ('100g', '13'), ('100g', '21'), ('100g', '6'), ('100g', '5'), ('100g', '21'), ('100g', '4'), ('100g', '1'), ('100g', '4'), ('100g', '12'), ('100g', '1')], 128), ([('100g', '12'), ('100g', '10'), ('100g', '4'), ('100g', '17'), ('100g', '20'), ('100g', '14'), ('100g', '1'), ('100g', '14'), ('100g', '12'), ('100g', '10'), ('100g', '8'), ('100g', '18'), ('100g', '14'), ('100g', '7'), ('100g', '10')], 118), ([('100g', '7'), ('100g', '4'), ('100g', '17'), ('100g', '22'), ('100g', '16'), ('100g', '12'), ('100g', '21'), ('100g', '7'), ('100g', '7'), ('100g', '5'), ('100g', '17'), ('100g', '5'), ('100g', '16'), ('100g', '9'), ('100g', '7')], 160), ([('100g', '22'), ('100g', '9'), ('100g', '13'), ('100g', '6'), ('100g', '8'), ('100g', '7'), ('100g', '13'), ('100g', '7'), ('100g', '19'), ('100g', '20'), ('100g', '5'), ('100g', '20'), ('100g','22'), ('100g', '4'), ('100g', '12')], 144), ([('100g', '2'), ('100g', '16'), ('100g', '4'), ('100g', '2'), ('100g', '8'), ('100g', '2'), ('100g', '16'), ('100g', '9'), ('100g', '12'), ('100g', '19'), ('100g', '20'), ('100g', '8'), ('100g', '22'), ('100g', '17'), ('100g', '20')], 176), ([('100g', '10'), ('100g', '12'), ('100g', '6'), ('100g', '14'), ('100g', '14'), ('100g', '14'), ('100g', '12'), ('100g', '2'), ('100g', '19'), ('100g', '14'), ('100g', '1'), ('100g', '10'), ('100g', '9'), ('100g','22'), ('100g', '13')], 103), ([('100g', '14'), ('100g', '8'), ('100g', '2'), ('100g', '16'), ('100g', '17'), ('100g', '14'), ('100g', '13'), ('100g', '19'), ('100g', '7'), ('100g', '13'), ('100g', '18'), ('100g', '5'), ('100g', '19'), ('100g', '8'),('100g', '19')], 138), ([('100g', '2'), ('100g', '1'), ('100g', '21'), ('100g', '21'), ('100g', '10'), ('100g', '21'), ('100g', '7'), ('100g', '3'), ('100g', '13'), ('100g', '21'), ('100g', '16'), ('100g', '1'), ('100g', '20'), ('100g', '2'), ('100g', '10')], 173), ([('100g', '16'), ('100g', '15'), ('100g', '12'), ('100g', '11'), ('100g', '11'), ('100g', '17'), ('100g', '21'), ('100g', '15'), ('100g', '14'), ('100g', '17'), ('100g', '3'), ('100g', '20'), ('100g', '15'), ('100g', '9'), ('100g', '17')], 128), ([('100g', '20'), ('100g', '5'), ('100g', '12'), ('100g', '5'), ('100g', '4'), ('100g', '7'), ('100g', '7'), ('100g', '2'), ('100g', '22'), ('100g', '10'), ('100g', '13'), ('100g', '11'), ('100g', '22'), ('100g', '3'), ('100g', '19')], 149), ([('100g', '20'), ('100g', '6'), ('100g', '1'), ('100g', '2'), ('100g', '16'), ('100g', '16'), ('100g', '5'), ('100g', '2'), ('100g', '19'), ('100g', '19'), ('100g', '15'), ('100g', '9'), ('100g', '2'), ('100g', '10'), ('100g', '10')], 151), ([('100g', '15'), ('100g', '14'), ('100g', '15'), ('100g', '6'), ('100g', '21'), ('100g', '3'), ('100g', '1'), ('100g', '19'), ('100g', '4'), ('100g', '4'), ('100g', '4'), ('100g', '2'), ('100g', '1'), ('100g', '11'), ('100g', '14')], 105), ([('100g', '22'), ('100g', '13'), ('100g', '11'), ('100g', '9'), ('100g', '15'), ('100g', '17'), ('100g', '3'), ('100g', '7'), ('100g', '1'), ('100g', '20'), ('100g', '6'), ('100g', '20'), ('100g', '2'), ('100g', '4'), ('100g', '4')], 132), ([('100g', '18'), ('100g','17'), ('100g', '13'), ('100g', '10'), ('100g', '5'), ('100g', '15'), ('100g', '6'), ('100g', '3'), ('100g', '17'), ('100g', '19'), ('100g', '5'), ('100g', '10'), ('100g', '17'), ('100g', '15'), ('100g', '4')], 111), ([('100g', '17'), ('100g', '11'),('100g', '19'), ('100g', '10'), ('100g', '14'), ('100g', '14'), ('100g', '12'), ('100g', '13'), ('100g', '16'), ('100g', '18'), ('100g', '18'), ('100g', '6'), ('100g', '11'), ('100g', '14'), ('100g', '20')], 105), ([('100g', '1'), ('100g', '17'), ('100g', '22'), ('100g', '6'), ('100g', '6'), ('100g', '17'), ('100g', '3'), ('100g', '9'), ('100g', '7'), ('100g', '9'), ('100g', '7'), ('100g', '15'), ('100g', '2'), ('100g', '22'), ('100g', '20')], 133), ([('100g', '17'), ('100g', '18'), ('100g', '2'), ('100g', '13'), ('100g', '12'), ('100g', '15'), ('100g', '21'), ('100g', '5'), ('100g', '2'), ('100g', '16'), ('100g', '12'), ('100g', '18'), ('100g', '17'), ('100g', '12'), ('100g', '2')], 153), ([('100g', '18'), ('100g', '14'), ('100g', '13'), ('100g', '3'), ('100g', '13'), ('100g', '1'), ('100g', '5'), ('100g', '20'), ('100g', '22'), ('100g', '4'), ('100g', '2'), ('100g', '6'), ('100g', '2'), ('100g', '3'), ('100g', '22')], 128), ([('100g', '2'), ('100g', '13'), ('100g', '4'), ('100g', '9'), ('100g', '16'), ('100g', '15'), ('100g', '3'), ('100g', '3'), ('100g', '5'), ('100g', '14'), ('100g', '18'), ('100g', '17'), ('100g', '20'), ('100g', '5'), ('100g', '9')], 145), ([('100g', '15'), ('100g', '18'), ('100g', '13'), ('100g', '16'), ('100g', '16'), ('100g', '17'), ('100g', '6'), ('100g', '13'), ('100g', '5'), ('100g', '22'), ('100g', '13'), ('100g', '14'), ('100g', '16'), ('100g', '10'), ('100g', '9')], 120), ([('100g', '20'), ('100g', '15'), ('100g', '12'), ('100g', '9'), ('100g', '11'), ('100g', '14'), ('100g', '7'), ('100g', '5'), ('100g', '5'), ('100g', '19'), ('100g', '21'), ('100g', '17'), ('100g', '7'), ('100g', '21'), ('100g', '4')], 156), ([('100g', '8'), ('100g', '3'), ('100g', '19'), ('100g', '1'), ('100g', '9'), ('100g','6'), ('100g', '17'), ('100g', '4'), ('100g', '8'), ('100g', '2'), ('100g', '13'), ('100g', '14'), ('100g', '15'), ('100g', '21'), ('100g', '15')], 137), ([('100g', '14'), ('100g', '9'), ('100g', '19'), ('100g', '18'), ('100g', '5'), ('100g', '17'), ('100g', '13'), ('100g', '3'), ('100g', '16'), ('100g', '14'), ('100g', '11'), ('100g', '8'), ('100g', '1'), ('100g', '14'), ('100g', '12')], 119), ([('100g', '9'), ('100g', '13'), ('100g', '9'), ('100g', '22'), ('100g', '16'), ('100g', '7'), ('100g','21'), ('100g', '4'), ('100g', '11'), ('100g', '11'), ('100g', '3'), ('100g', '9'), ('100g', '13'), ('100g', '22'), ('100g', '17')], 150), ([('100g', '12'), ('100g', '11'), ('100g', '19'), ('100g', '12'), ('100g', '10'), ('100g', '16'), ('100g', '4'), ('100g', '11'), ('100g', '6'), ('100g', '20'), ('100g', '16'), ('100g', '2'), ('100g', '6'), ('100g', '20'), ('100g', '5')], 131), ([('100g', '12'), ('100g', '9'), ('100g', '22'), ('100g', '8'), ('100g', '9'), ('100g', '18'), ('100g', '19'), ('100g', '18'), ('100g', '15'), ('100g', '19'), ('100g', '16'), ('100g', '21'), ('100g', '22'), ('100g', '2'), ('100g', '15')], 149), ([('100g', '20'), ('100g', '12'), ('100g', '20'), ('100g', '5'), ('100g', '14'), ('100g', '19'), ('100g', '7'), ('100g', '15'), ('100g', '6'), ('100g', '9'), ('100g', '22'), ('100g', '10'), ('100g', '21'), ('100g', '7'), ('100g', '20')], 146), ([('100g', '1'), ('100g', '19'), ('100g', '10'), ('100g', '5'), ('100g', '16'), ('100g', '14'), ('100g', '10'), ('100g', '21'), ('100g', '4'), ('100g', '20'), ('100g', '15'), ('100g', '7'), ('100g', '8'), ('100g', '14'), ('100g', '8')], 147)]
test3 = [([('100g', '13'), ('100g', '9'), ('100g', '4'), ('100g', '7'), ('100g', '9'), ('100g', '3'), ('100g', '15'), ('100g', '11'), ('100g', '11'), ('100g', '17'), ('100g', '13'), ('100g', '12'), ('100g', '5'), ('100g', '11'), ('100g', '18')], 141), ([('100g', '11'), ('100g', '17'), ('100g', '22'), ('100g', '15'), ('100g', '12'), ('100g', '22'), ('100g', '12'), ('100g', '3'), ('100g', '2'), ('100g', '13'), ('100g', '21'), ('100g', '17'), ('100g', '1'), ('100g', '13'), ('100g', '20')], 128), ([('100g', '21'), ('100g', '2'), ('100g', '15'), ('100g', '4'), ('100g', '9'), ('100g', '19'), ('100g', '3'), ('100g', '1'), ('100g', '16'), ('100g', '22'), ('100g', '18'), ('100g', '17'), ('100g', '19'), ('100g', '15'), ('100g', '17')], 123), ([('100g', '9'), ('100g', '8'), ('100g', '12'), ('100g', '15'), ('100g', '8'), ('100g', '14'), ('100g', '21'), ('100g', '6'), ('100g', '4'), ('100g', '16'), ('100g', '7'), ('100g', '7'), ('100g', '3'), ('100g', '6'), ('100g', '21')], 150), ([('100g', '6'), ('100g', '6'), ('100g', '21'), ('100g', '7'), ('100g', '15'), ('100g', '16'), ('100g', '12'), ('100g', '2'), ('100g', '22'), ('100g', '22'), ('100g', '3'), ('100g', '7'), ('100g', '22'), ('100g', '7'), ('100g', '7')], 142), ([('100g', '13'), ('100g', '13'), ('100g', '4'), ('100g', '4'), ('100g', '16'), ('100g', '13'), ('100g', '9'), ('100g', '12'), ('100g', '1'), ('100g', '9'), ('100g', '11'), ('100g', '12'), ('100g', '3'), ('100g', '13'), ('100g', '20')], 122), ([('100g', '9'), ('100g', '17'), ('100g', '16'), ('100g', '4'), ('100g', '8'), ('100g', '10'), ('100g', '17'), ('100g', '20'), ('100g', '15'), ('100g', '1'), ('100g', '11'), ('100g', '13'), ('100g', '17'), ('100g', '8'), ('100g', '15')], 140), ([('100g', '1'), ('100g', '16'), ('100g', '1'), ('100g', '9'), ('100g', '6'), ('100g', '4'), ('100g', '12'), ('100g', '13'), ('100g', '14'), ('100g', '19'), ('100g', '20'), ('100g', '14'), ('100g', '17'), ('100g', '13'), ('100g', '2')], 107), ([('100g', '1'), ('100g', '9'), ('100g', '19'), ('100g', '4'), ('100g', '16'), ('100g', '20'), ('100g', '1'), ('100g', '8'), ('100g', '20'), ('100g', '20'), ('100g', '2'), ('100g', '5'), ('100g', '9'), ('100g', '9'), ('100g', '16')], 164), ([('100g', '19'), ('100g', '3'), ('100g', '22'), ('100g','5'), ('100g', '1'), ('100g', '1'), ('100g', '15'), ('100g', '13'), ('100g', '15'), ('100g', '13'), ('100g', '4'), ('100g', '18'), ('100g', '2'), ('100g', '5'), ('100g', '10')], 123)]
train4 = [([('100g', '22'), ('100g', '10'), ('100g', '1'), ('100g', '9'), ('100g', '14'), ('100g', '20'), ('100g', '8'), ('100g', '1'), ('100g', '6'), ('100g', '21'), ('100g', '10'), ('100g', '8'), ('100g', '15'), ('100g', '17'), ('100g', '8'), ('100g', '17'), ('100g', '2'), ('100g', '16'), ('100g', '13'), ('100g', '17')], 195), ([('100g', '11'), ('100g', '1'), ('100g', '6'), ('100g', '9'), ('100g', '5'), ('100g', '18'), ('100g', '1'), ('100g', '4'), ('100g', '15'), ('100g', '19'), ('100g', '13'), ('100g', '12'), ('100g', '17'), ('100g', '8'), ('100g', '22'), ('100g', '12'), ('100g', '3'), ('100g', '17'), ('100g', '3'), ('100g', '7')], 156), ([('100g', '4'), ('100g', '12'), ('100g', '14'), ('100g', '16'), ('100g', '18'), ('100g', '15'), ('100g', '16'), ('100g', '5'), ('100g', '8'), ('100g', '15'), ('100g', '1'), ('100g', '14'), ('100g', '21'), ('100g', '21'), ('100g', '14'), ('100g', '2'), ('100g', '1'), ('100g', '20'), ('100g', '1'), ('100g', '3')], 176), ([('100g', '14'), ('100g', '22'), ('100g', '8'), ('100g', '2'), ('100g', '17'), ('100g', '3'), ('100g', '6'), ('100g', '10'), ('100g', '6'), ('100g', '11'), ('100g', '5'), ('100g', '10'), ('100g', '5'), ('100g', '22'), ('100g', '17'), ('100g', '1'), ('100g', '22'), ('100g', '4'), ('100g', '16'), ('100g', '8')], 180), ([('100g', '9'), ('100g', '10'), ('100g', '15'), ('100g', '16'), ('100g', '11'), ('100g', '18'), ('100g', '5'), ('100g', '22'), ('100g', '13'), ('100g', '15'), ('100g', '12'), ('100g', '18'), ('100g', '16'), ('100g', '9'), ('100g', '18'), ('100g', '19'), ('100g', '6'), ('100g', '12'), ('100g', '21'), ('100g', '1')], 171), ([('100g', '14'), ('100g', '17'), ('100g', '8'), ('100g', '12'), ('100g', '11'), ('100g', '7'), ('100g', '3'), ('100g', '10'), ('100g','13'), ('100g', '6'), ('100g', '13'), ('100g', '18'), ('100g', '14'), ('100g', '10'), ('100g', '7'), ('100g', '4'), ('100g', '21'), ('100g', '4'), ('100g', '9'), ('100g', '3')], 171), ([('100g', '7'), ('100g', '17'), ('100g', '13'), ('100g', '11'), ('100g', '17'), ('100g', '10'), ('100g', '2'), ('100g', '1'), ('100g', '15'), ('100g', '22'), ('100g', '19'), ('100g', '2'), ('100g', '2'), ('100g', '20'), ('100g', '6'), ('100g', '13'), ('100g', '4'), ('100g', '1'), ('100g', '15'), ('100g', '3')], 173), ([('100g', '5'), ('100g', '7'), ('100g', '3'), ('100g', '7'), ('100g', '10'), ('100g', '20'), ('100g', '12'), ('100g', '20'), ('100g', '4'), ('100g', '6'), ('100g', '1'), ('100g', '9'), ('100g', '14'), ('100g', '21'), ('100g', '18'), ('100g', '16'), ('100g', '20'), ('100g', '16'), ('100g', '14'), ('100g', '7')], 186), ([('100g', '21'), ('100g', '9'), ('100g', '8'), ('100g', '13'), ('100g', '7'), ('100g', '9'), ('100g', '13'), ('100g', '11'), ('100g', '16'), ('100g', '3'), ('100g', '21'), ('100g', '16'), ('100g', '3'), ('100g', '6'), ('100g', '12'), ('100g', '1'), ('100g', '21'), ('100g', '11'), ('100g', '17'), ('100g', '2')], 209), ([('100g', '10'), ('100g', '10'), ('100g', '18'), ('100g', '13'), ('100g', '2'), ('100g', '20'), ('100g', '8'), ('100g', '2'), ('100g', '5'), ('100g', '1'), ('100g', '17'), ('100g', '9'), ('100g', '22'), ('100g', '19'), ('100g', '15'), ('100g', '14'), ('100g', '2'), ('100g', '20'), ('100g', '14'), ('100g', '8')], 212), ([('100g', '8'), ('100g', '4'), ('100g','1'), ('100g', '9'), ('100g', '2'), ('100g', '18'), ('100g', '9'), ('100g', '12'), ('100g', '5'), ('100g', '10'), ('100g', '7'), ('100g', '1'), ('100g', '10'), ('100g', '2'), ('100g', '22'), ('100g', '9'), ('100g', '8'), ('100g', '22'), ('100g', '11'), ('100g', '2')], 232), ([('100g', '9'), ('100g', '19'), ('100g', '7'), ('100g', '22'), ('100g', '1'), ('100g', '7'), ('100g', '10'), ('100g', '22'), ('100g', '11'), ('100g', '14'), ('100g', '12'), ('100g', '18'), ('100g', '9'), ('100g', '5'), ('100g', '15'), ('100g', '3'), ('100g', '17'), ('100g', '5'), ('100g', '8'), ('100g', '11')], 192), ([('100g', '4'), ('100g', '21'), ('100g', '4'), ('100g', '19'), ('100g', '8'), ('100g', '20'), ('100g', '10'), ('100g', '11'), ('100g', '1'), ('100g', '20'),('100g', '20'), ('100g', '8'), ('100g', '5'), ('100g', '2'), ('100g', '22'), ('100g', '3'), ('100g', '7'), ('100g', '5'), ('100g', '9'), ('100g', '2')], 233), ([('100g', '8'), ('100g', '18'), ('100g', '9'), ('100g', '2'), ('100g', '21'), ('100g', '19'), ('100g', '3'), ('100g', '15'), ('100g', '10'), ('100g', '2'), ('100g', '12'), ('100g', '15'), ('100g', '4'), ('100g', '12'), ('100g', '10'), ('100g', '22'), ('100g', '22'), ('100g', '20'), ('100g', '11'), ('100g', '10')], 200), ([('100g', '13'), ('100g', '21'), ('100g', '8'), ('100g', '9'), ('100g', '9'), ('100g', '10'), ('100g', '18'), ('100g', '16'), ('100g', '11'), ('100g', '16'), ('100g', '10'), ('100g', '13'), ('100g', '1'), ('100g', '15'), ('100g', '12'), ('100g', '7'), ('100g', '20'), ('100g', '4'), ('100g', '19'), ('100g', '17')], 189), ([('100g', '19'), ('100g', '3'), ('100g', '18'), ('100g', '8'), ('100g', '4'), ('100g', '12'), ('100g', '22'), ('100g', '13'), ('100g', '19'), ('100g', '5'), ('100g', '8'), ('100g', '15'), ('100g', '16'), ('100g', '15'), ('100g', '1'), ('100g', '2'), ('100g', '22'), ('100g', '15'), ('100g', '1'), ('100g', '17')], 169), ([('100g', '12'), ('100g', '14'), ('100g', '5'), ('100g', '10'), ('100g', '15'), ('100g', '13'), ('100g', '19'), ('100g', '1'), ('100g', '7'), ('100g', '21'), ('100g', '11'), ('100g', '4'), ('100g', '16'), ('100g', '9'), ('100g', '3'), ('100g', '22'), ('100g', '20'), ('100g', '2'), ('100g', '16'), ('100g', '17')], 183), ([('100g', '14'), ('100g', '17'), ('100g', '15'), ('100g', '4'), ('100g', '17'), ('100g', '8'), ('100g', '17'), ('100g', '4'), ('100g', '12'), ('100g', '10'), ('100g', '2'), ('100g', '6'), ('100g', '4'), ('100g', '21'), ('100g', '7'), ('100g', '3'), ('100g', '2'), ('100g', '1'), ('100g', '5'), ('100g', '8')], 189), ([('100g', '1'), ('100g', '16'), ('100g', '1'), ('100g', '5'), ('100g', '16'), ('100g', '8'), ('100g', '8'), ('100g', '22'), ('100g', '5'), ('100g', '19'), ('100g', '11'), ('100g', '4'), ('100g', '1'), ('100g', '2'), ('100g', '11'), ('100g', '12'), ('100g', '16'), ('100g', '19'), ('100g', '20'), ('100g', '5')], 197), ([('100g', '18'), ('100g', '12'), ('100g', '1'), ('100g', '14'), ('100g', '11'), ('100g', '15'), ('100g', '18'), ('100g', '13'), ('100g', '1'), ('100g', '19'), ('100g', '8'),('100g', '19'), ('100g', '9'), ('100g', '14'), ('100g', '15'), ('100g', '22'), ('100g', '7'), ('100g', '19'), ('100g', '15'), ('100g', '3')], 148), ([('100g', '16'), ('100g', '8'), ('100g', '9'), ('100g', '12'), ('100g', '21'), ('100g', '12'), ('100g', '19'), ('100g', '15'), ('100g', '16'), ('100g', '12'), ('100g', '17'), ('100g', '18'), ('100g', '20'), ('100g', '4'), ('100g', '11'), ('100g', '13'), ('100g', '6'), ('100g', '20'), ('100g', '14'), ('100g', '17')], 169), ([('100g', '14'), ('100g', '18'), ('100g', '20'), ('100g', '3'), ('100g', '8'), ('100g', '8'), ('100g', '1'), ('100g', '4'), ('100g', '1'), ('100g', '9'), ('100g', '9'), ('100g', '9'), ('100g', '11'), ('100g', '8'), ('100g', '17'), ('100g', '3'), ('100g', '22'), ('100g', '6'), ('100g', '22'), ('100g', '14')], 185), ([('100g', '1'), ('100g', '2'), ('100g', '19'), ('100g', '4'), ('100g', '15'), ('100g', '8'), ('100g', '11'), ('100g', '14'), ('100g', '15'), ('100g', '17'), ('100g', '12'), ('100g', '9'), ('100g', '7'), ('100g', '22'), ('100g', '6'), ('100g', '22'), ('100g', '17'), ('100g', '4'), ('100g', '18'), ('100g', '17')], 162), ([('100g', '21'), ('100g', '15'), ('100g', '1'), ('100g', '15'), ('100g', '10'), ('100g', '7'), ('100g', '15'), ('100g', '20'), ('100g', '10'),('100g', '17'), ('100g', '19'), ('100g', '15'), ('100g', '9'), ('100g', '13'), ('100g', '22'), ('100g', '4'), ('100g', '10'), ('100g', '9'), ('100g', '9'), ('100g', '4')], 179), ([('100g', '18'), ('100g', '12'), ('100g', '17'), ('100g', '8'), ('100g', '4'), ('100g', '4'), ('100g', '1'), ('100g', '4'), ('100g', '9'), ('100g', '18'), ('100g', '13'), ('100g', '16'), ('100g', '1'), ('100g', '11'), ('100g', '5'), ('100g', '4'), ('100g', '3'), ('100g', '19'), ('100g', '13'), ('100g', '21')], 166), ([('100g', '20'), ('100g', '10'), ('100g', '19'), ('100g', '4'), ('100g', '5'), ('100g', '12'), ('100g', '12'), ('100g', '21'), ('100g', '9'), ('100g', '7'), ('100g', '20'), ('100g', '11'), ('100g', '17'), ('100g', '16'), ('100g', '7'), ('100g', '1'), ('100g', '20'), ('100g', '20'), ('100g', '6'), ('100g', '12')], 187), ([('100g', '12'), ('100g', '5'), ('100g', '5'), ('100g', '21'), ('100g', '19'), ('100g', '12'), ('100g', '10'), ('100g', '12'), ('100g', '21'), ('100g', '11'), ('100g', '11'), ('100g','3'), ('100g', '14'), ('100g', '4'), ('100g', '8'), ('100g', '20'), ('100g', '14'), ('100g', '18'), ('100g', '9'), ('100g', '14')], 189), ([('100g', '21'), ('100g', '5'), ('100g', '14'), ('100g', '21'), ('100g', '5'), ('100g', '20'), ('100g', '18'), ('100g', '13'), ('100g', '6'), ('100g', '18'), ('100g', '15'), ('100g', '3'), ('100g', '12'), ('100g', '19'), ('100g', '14'), ('100g', '4'), ('100g', '19'), ('100g', '20'), ('100g', '22'), ('100g', '19')], 162), ([('100g', '6'), ('100g', '11'), ('100g', '18'), ('100g', '18'), ('100g', '1'), ('100g', '2'), ('100g', '18'), ('100g', '9'), ('100g', '7'), ('100g', '18'), ('100g', '16'), ('100g', '18'), ('100g', '20'), ('100g', '9'), ('100g', '4'), ('100g', '20'), ('100g', '5'), ('100g', '7'), ('100g', '13'), ('100g', '19')], 193), ([('100g', '3'), ('100g', '2'), ('100g', '6'), ('100g', '20'), ('100g', '8'), ('100g', '19'), ('100g', '16'), ('100g', '11'), ('100g', '8'), ('100g', '21'), ('100g', '13'), ('100g', '9'), ('100g', '19'), ('100g', '4'), ('100g', '2'), ('100g', '9'), ('100g', '12'), ('100g', '11'), ('100g', '11'), ('100g', '11')], 216), ([('100g', '2'), ('100g', '3'), ('100g', '6'), ('100g', '15'), ('100g', '14'), ('100g', '10'), ('100g', '2'), ('100g', '8'), ('100g', '17'), ('100g', '11'), ('100g', '8'), ('100g', '22'), ('100g', '4'), ('100g', '12'), ('100g', '19'), ('100g', '3'), ('100g', '8'), ('100g', '5'), ('100g', '7'), ('100g', '21')], 208), ([('100g', '6'), ('100g', '16'), ('100g', '4'), ('100g', '17'), ('100g', '18'), ('100g', '5'), ('100g', '5'), ('100g', '16'), ('100g', '2'), ('100g', '8'), ('100g', '10'), ('100g', '8'), ('100g', '12'), ('100g', '8'), ('100g', '8'), ('100g', '19'), ('100g', '16'), ('100g', '14'), ('100g', '16'), ('100g', '4')], 205), ([('100g', '22'),('100g', '1'), ('100g', '8'), ('100g', '13'), ('100g', '1'), ('100g', '7'), ('100g', '14'), ('100g', '3'), ('100g', '21'), ('100g', '21'), ('100g', '16'), ('100g', '6'), ('100g', '4'), ('100g', '10'), ('100g', '7'), ('100g', '10'), ('100g', '22'), ('100g', '5'), ('100g', '3'), ('100g', '21')], 188), ([('100g', '19'), ('100g', '12'), ('100g', '21'), ('100g', '5'), ('100g', '21'), ('100g', '16'), ('100g', '18'), ('100g', '18'), ('100g', '3'), ('100g', '15'), ('100g', '19'), ('100g', '20'), ('100g','20'), ('100g', '22'), ('100g', '8'), ('100g', '9'), ('100g', '10'), ('100g', '8'), ('100g', '19'), ('100g', '17')], 199), ([('100g', '15'), ('100g', '18'), ('100g', '14'), ('100g', '6'), ('100g', '17'), ('100g', '15'), ('100g', '16'), ('100g', '4'),('100g', '8'), ('100g', '4'), ('100g', '12'), ('100g', '9'), ('100g', '2'), ('100g', '18'), ('100g', '11'), ('100g', '16'), ('100g', '10'), ('100g', '20'), ('100g', '10'), ('100g', '20')], 181), ([('100g', '9'), ('100g', '5'), ('100g', '6'), ('100g','18'), ('100g', '7'), ('100g', '2'), ('100g', '19'), ('100g', '20'), ('100g', '4'), ('100g', '20'), ('100g', '16'), ('100g', '18'), ('100g', '22'), ('100g', '7'), ('100g', '13'), ('100g', '16'), ('100g', '18'), ('100g', '3'), ('100g', '9'), ('100g', '19')], 189), ([('100g', '21'), ('100g', '4'), ('100g', '20'), ('100g', '7'), ('100g', '22'), ('100g', '14'), ('100g', '7'), ('100g', '10'), ('100g', '21'), ('100g', '3'), ('100g', '15'), ('100g', '3'), ('100g', '8'), ('100g', '9'), ('100g', '2'), ('100g', '10'), ('100g', '9'), ('100g', '9'), ('100g', '22'), ('100g', '8')], 229), ([('100g', '11'), ('100g', '12'), ('100g', '2'), ('100g', '16'), ('100g', '2'), ('100g', '6'), ('100g', '8'), ('100g', '18'), ('100g', '1'), ('100g', '8'), ('100g', '6'),('100g', '5'), ('100g', '14'), ('100g', '18'), ('100g', '16'), ('100g', '7'), ('100g', '5'), ('100g', '20'), ('100g', '2'), ('100g', '11')], 217), ([('100g', '17'), ('100g', '18'), ('100g', '4'), ('100g', '13'), ('100g', '4'), ('100g', '17'), ('100g', '1'), ('100g', '12'), ('100g', '19'), ('100g', '8'), ('100g', '20'), ('100g', '17'), ('100g', '12'), ('100g', '5'), ('100g', '14'), ('100g', '1'), ('100g', '2'), ('100g', '6'), ('100g', '19'), ('100g', '8')], 159), ([('100g', '12'), ('100g', '17'), ('100g', '21'), ('100g', '14'), ('100g', '5'), ('100g', '7'), ('100g', '7'), ('100g', '5'), ('100g', '17'), ('100g', '13'), ('100g', '21'), ('100g', '1'), ('100g', '17'), ('100g', '8'), ('100g', '3'), ('100g', '4'), ('100g', '14'), ('100g', '16'), ('100g', '13'), ('100g', '11')], 186), ([('100g', '21'), ('100g', '1'), ('100g', '10'), ('100g', '2'), ('100g', '9'), ('100g', '21'), ('100g', '3'), ('100g', '9'), ('100g', '13'), ('100g', '19'), ('100g', '13'), ('100g', '1'), ('100g', '16'), ('100g', '4'), ('100g', '9'), ('100g', '17'), ('100g', '13'), ('100g', '13'), ('100g', '4'), ('100g', '1')], 178), ([('100g', '2'), ('100g', '18'), ('100g', '15'), ('100g', '20'), ('100g', '18'), ('100g', '19'), ('100g', '10'), ('100g', '16'), ('100g', '19'), ('100g', '10'), ('100g', '6'), ('100g', '22'), ('100g', '16'), ('100g', '6'), ('100g', '3'), ('100g', '19'), ('100g', '1'), ('100g', '12'), ('100g', '7'), ('100g', '12')], 148), ([('100g', '3'), ('100g', '16'), ('100g', '8'), ('100g', '9'), ('100g', '4'), ('100g', '11'), ('100g', '12'), ('100g', '22'), ('100g', '22'), ('100g', '21'), ('100g', '19'), ('100g', '11'), ('100g', '10'), ('100g', '6'), ('100g', '12'), ('100g', '4'), ('100g', '12'), ('100g', '6'), ('100g', '5'), ('100g', '9')], 176), ([('100g', '11'), ('100g', '8'), ('100g', '5'), ('100g', '5'), ('100g', '15'), ('100g', '8'), ('100g', '17'), ('100g', '2'), ('100g', '7'), ('100g', '16'), ('100g', '13'), ('100g', '5'), ('100g', '16'), ('100g', '22'), ('100g', '3'), ('100g', '10'), ('100g', '1'), ('100g', '6'), ('100g', '9'), ('100g', '14')], 205), ([('100g', '7'), ('100g', '22'), ('100g', '3'), ('100g', '19'), ('100g', '11'), ('100g', '13'), ('100g', '20'), ('100g', '2'), ('100g', '5'), ('100g', '13'), ('100g', '17'), ('100g', '6'), ('100g', '14'), ('100g', '5'), ('100g', '3'), ('100g', '8'), ('100g', '4'), ('100g', '17'), ('100g', '6'), ('100g', '20')], 176), ([('100g', '2'), ('100g', '16'), ('100g', '1'), ('100g', '7'), ('100g', '6'), ('100g', '5'), ('100g', '13'), ('100g', '15'), ('100g', '10'), ('100g', '2'), ('100g', '1'), ('100g', '4'), ('100g', '4'), ('100g', '14'), ('100g', '16'), ('100g', '10'), ('100g', '11'), ('100g', '12'), ('100g', '13'), ('100g', '2')], 181), ([('100g', '5'), ('100g', '15'), ('100g', '6'), ('100g', '5'), ('100g', '5'), ('100g', '19'), ('100g', '2'), ('100g', '22'), ('100g', '21'), ('100g', '2'), ('100g', '8'), ('100g', '21'), ('100g', '16'), ('100g', '17'), ('100g', '5'), ('100g', '22'), ('100g', '17'), ('100g', '19'), ('100g', '20'), ('100g', '9')], 222), ([('100g', '6'), ('100g', '11'), ('100g', '12'), ('100g', '19'), ('100g', '11'), ('100g', '4'), ('100g', '13'), ('100g', '9'), ('100g', '7'), ('100g', '18'), ('100g', '20'), ('100g', '5'), ('100g', '11'), ('100g', '22'), ('100g', '18'),('100g', '6'), ('100g', '11'), ('100g', '22'), ('100g', '6'), ('100g', '1')], 162), ([('100g', '13'), ('100g', '16'), ('100g', '12'), ('100g', '7'), ('100g', '13'), ('100g', '8'), ('100g', '8'), ('100g', '20'), ('100g', '10'), ('100g', '8'), ('100g','5'), ('100g', '19'), ('100g', '14'), ('100g', '17'), ('100g', '21'), ('100g', '9'), ('100g', '7'), ('100g', '8'), ('100g', '18'), ('100g', '9')], 228), ([('100g', '14'), ('100g', '8'), ('100g', '4'), ('100g', '11'), ('100g', '5'), ('100g', '21'), ('100g', '13'), ('100g', '13'), ('100g', '20'), ('100g', '5'), ('100g', '3'), ('100g', '16'), ('100g', '21'), ('100g', '5'), ('100g', '14'), ('100g', '9'), ('100g', '4'), ('100g', '17'), ('100g', '21'), ('100g', '4')], 206)]
test4 = [([('100g', '20'), ('100g', '10'), ('100g', '2'), ('100g', '22'), ('100g', '4'), ('100g', '7'), ('100g', '1'), ('100g', '8'), ('100g', '10'), ('100g', '3'), ('100g', '14'), ('100g', '9'), ('100g', '18'), ('100g', '15'), ('100g', '18'), ('100g', '12'), ('100g', '6'), ('100g', '8'), ('100g', '10'), ('100g', '4')], 185), ([('100g', '10'), ('100g', '22'), ('100g', '19'), ('100g', '17'), ('100g', '15'), ('100g', '1'), ('100g', '16'), ('100g', '1'), ('100g', '10'), ('100g', '12'), ('100g', '15'), ('100g', '18'), ('100g', '1'), ('100g', '10'), ('100g', '22'), ('100g', '9'), ('100g', '17'), ('100g', '17'), ('100g', '19'), ('100g', '4')], 138), ([('100g', '19'), ('100g', '9'), ('100g', '15'), ('100g', '20'), ('100g', '2'), ('100g', '12'), ('100g', '20'), ('100g', '6'), ('100g', '18'), ('100g', '20'), ('100g', '22'), ('100g', '4'), ('100g', '2'), ('100g', '7'), ('100g', '1'), ('100g', '14'), ('100g', '14'), ('100g', '6'), ('100g', '16'), ('100g', '20')], 175), ([('100g', '15'), ('100g', '8'), ('100g', '13'), ('100g', '6'), ('100g', '20'), ('100g', '4'), ('100g', '4'), ('100g', '9'), ('100g', '13'), ('100g', '11'), ('100g', '7'), ('100g', '12'), ('100g', '3'), ('100g', '1'), ('100g', '6'), ('100g', '16'), ('100g', '7'), ('100g', '7'), ('100g', '19'), ('100g', '21')], 176), ([('100g', '5'), ('100g', '7'), ('100g', '3'), ('100g', '22'), ('100g', '4'), ('100g', '14'), ('100g', '14'), ('100g', '19'), ('100g', '2'), ('100g', '8'), ('100g', '6'), ('100g', '2'), ('100g', '19'), ('100g', '5'), ('100g', '17'), ('100g', '8'), ('100g', '11'), ('100g', '3'), ('100g', '20'), ('100g', '16')], 195), ([('100g', '9'), ('100g', '9'), ('100g', '3'), ('100g', '21'), ('100g', '17'), ('100g', '15'), ('100g', '11'), ('100g', '13'), ('100g', '12'), ('100g', '4'), ('100g', '14'), ('100g', '15'), ('100g', '20'), ('100g', '1'), ('100g', '15'), ('100g', '22'), ('100g', '5'), ('100g', '7'), ('100g', '13'), ('100g', '2')], 187), ([('100g', '4'), ('100g', '4'), ('100g', '15'), ('100g', '2'), ('100g', '21'), ('100g', '14'), ('100g', '4'), ('100g', '1'), ('100g', '5'), ('100g', '21'), ('100g', '10'), ('100g', '20'), ('100g', '14'), ('100g', '22'), ('100g', '5'), ('100g', '16'), ('100g', '13'), ('100g', '9'), ('100g', '1'), ('100g', '22')], 186), ([('100g', '11'), ('100g', '21'), ('100g', '13'), ('100g', '10'), ('100g', '17'), ('100g', '16'), ('100g', '16'), ('100g', '13'), ('100g', '6'), ('100g', '6'), ('100g', '21'), ('100g', '18'), ('100g', '11'), ('100g', '7'), ('100g', '12'), ('100g', '13'), ('100g', '22'), ('100g', '1'), ('100g', '11'), ('100g', '9')], 176), ([('100g', '11'), ('100g', '20'), ('100g', '8'), ('100g', '9'), ('100g', '9'), ('100g', '12'), ('100g', '16'), ('100g', '2'), ('100g', '11'), ('100g', '1'), ('100g', '8'), ('100g', '13'), ('100g', '19'), ('100g', '9'), ('100g', '20'), ('100g', '10'), ('100g', '22'), ('100g', '18'), ('100g', '16'), ('100g', '19')], 210), ([('100g', '19'), ('100g', '22'), ('100g', '6'), ('100g', '4'), ('100g', '6'), ('100g', '17'), ('100g', '13'), ('100g', '5'), ('100g', '17'), ('100g', '14'), ('100g', '4'), ('100g', '7'), ('100g', '18'), ('100g', '5'), ('100g', '10'), ('100g', '8'), ('100g', '14'), ('100g', '18'), ('100g', '17'), ('100g', '8')], 163)]
train_test_data = [train1, test1, train2, test2, train3, test3, train4, test4]

class Node(object):
    def __init__(self, id, task_duration, resource, features=None):
        self.node_id = id
        self.task_duration = task_duration
        self.resource = resource
        self.features = features
        self.descent_nodes = []
        self.child_nodes = []
        self.parent_nodes = []


def load_job(resource_limit, feature_dim, resource_dim, file_path, query_size, query_idx, tpch_num, offset):
    query_path = file_path + query_size + '/'
    adj_mat_path = query_path + 'adj_mat_' + str(query_idx) + '.npy'
    duration_path = query_path + 'task_duration_' + str(query_idx) + '.npy'
    adj_mat = np.load(adj_mat_path, allow_pickle=True)
    task_durations = np.load(duration_path, allow_pickle=True).item()

    assert adj_mat.shape[0] == adj_mat.shape[1]
    assert adj_mat.shape[0] == len(task_durations)
    num_nodes = adj_mat.shape[0]
    dummy_features = [0.0] * feature_dim

    # generate DAG
    job_dag = nx.DiGraph()
    parents = {}

    # nodes = []
    for index in range(num_nodes):
        n = offset + index
        parents[n] = []
        task_duration = task_durations[index]
        e = next(iter(task_duration['first_wave']))

        num_tasks = len(task_duration['first_wave'][e]) + \
                    len(task_duration['rest_wave'][e])

        # remove fresh duration from first wave duration
        # drag nearest neighbor first wave duration to empty spots
        pre_process_task_duration(task_duration)
        rough_duration = np.mean(
            [i for l in task_duration['first_wave'].values() for i in l] + \
            [i for l in task_duration['rest_wave'].values() for i in l] + \
            [i for l in task_duration['fresh_durations'].values() for i in l])

        # generate a node
        features = [rough_duration / 5000.0]  # normalize duration by 5000 (true running time=x5000)
        # features = [np.random.uniform(0, 1)]
        if resource_dim == 1:
            features.extend([num_tasks / resource_limit])
        else:
            key_id = int(query_size.replace('g', '')) * tpch_num + int(query_idx)
            np_random = np.random.RandomState(key_id)
            features.extend(np.multiply(np_random.rand(resource_dim), 0.5))
            #features.extend(np.multiply(np_random.randint(1, 6, resource_dim), 0.1))
            #features.extend(np_random.uniform(0.1, 0.5, resource_dim))
            #res = [0.1, 0.2, 0.3, 0.4, 0.5]
            #indice = np_random.randint(0, len(res), resource_dim)
            #features.extend(np.take(res, indice).tolist())
            #res = [0.0016666666666666668, 0.0016666666666666668, 0.0016666666666666668, 0.0016666666666666668, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.03166666666666667, 0.03166666666666667, 0.03166666666666667, 0.15166666666666667, 0.22166666666666668, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.9883333333333333, 0.9883333333333333, 0.9883333333333333, 0.9883333333333333, 0.9883333333333333]
            #indice = np_random.randint(0, len(res), resource_dim)
            #features.extend(np.take(res, indice))

        job_dag.add_node(n, features=features)
        # node = Node(n, rough_duration, num_tasks, features)
        # nodes.append(node)

    # parent and child node info
    for i in range(num_nodes):
        for j in range(num_nodes):
            if adj_mat[i, j] == 1:
                i_index, j_index = offset + i, offset + j
                job_dag.add_edge(j_index, i_index, features=dummy_features)
                parents[j_index].append(i_index)

    roots = []
    for node, parent in parents.items():
        if len(parent) == 0:
            roots.append(node)
    return (job_dag, roots)


def pre_process_task_duration(task_duration):
    # remove fresh durations from first wave
    clean_first_wave = {}
    for e in task_duration['first_wave']:
        clean_first_wave[e] = []
        fresh_durations = SetWithCount()
        # O(1) access
        for d in task_duration['fresh_durations'][e]:
            fresh_durations.add(d)
        for d in task_duration['first_wave'][e]:
            if d not in fresh_durations:
                clean_first_wave[e].append(d)
            else:
                # prevent duplicated fresh duration blocking first wave
                fresh_durations.remove(d)

    # fill in nearest neighour first wave
    last_first_wave = []
    for e in sorted(clean_first_wave.keys()):
        if len(clean_first_wave[e]) == 0:
            clean_first_wave[e] = last_first_wave
        last_first_wave = clean_first_wave[e]

    # swap the first wave with fresh durations removed
    task_duration['first_wave'] = clean_first_wave


def recursive_find_descendant(node):
    if len(node.descendant_nodes) > 0:  # already visited
        return node.descendant_nodes
    else:
        node.descendant_nodes = [node]
        for child_node in node.child_nodes:  # terminate on leaves automatically
            child_descendant_nodes = recursive_find_descendant(child_node)
            for dn in child_descendant_nodes:
                if dn not in node.descendant_nodes:  # remove dual path duplicates
                    node.descendant_nodes.append(dn)
        return node.descendant_nodes


def generate_alibaba_jobs():
    pass


class Args(object):
    def __init__(self, feature_dim=2, resource_dim=1, num_init_dags=5):
        self.feature_dim = feature_dim
        self.resource_dim = resource_dim
        self.num_init_dags = num_init_dags
        self.tpch_num = 22
        self.tpch_size = ['2g', '5g', '10g', '20g', '50g', '80g', '100g']
        self.job_folder = 'dag_data/tpch/'
        self.query_type = 'tpch'


def load_tpch_jobs(resource_limit=600, feature_dim=2, resource_dim=1, num_init_dags=5, tid=0, dag_id=0):
    args = Args(feature_dim=feature_dim, resource_dim=resource_dim,
                num_init_dags=num_init_dags)
    job_dags, roots, offsets, graphs = [], [], [], []
    offset = 1
    np.random.seed(int(resource_limit + num_init_dags + tid) * (dag_id + 1))
    tpchs = np.random.choice(args.tpch_num, size=num_init_dags, replace=True) + 1

    for i, t in enumerate(tpchs):
        offsets.append(offset)
        # generate query
        try:
            query_size, query_idx = dag_data_dict[num_init_dags][tid][dag_id][i]
        except KeyError:
            print(f'Warning: #dags={num_init_dags} tid={tid} dag_id={dag_id} not found in dag_dict.py, '
                  f'generate randomly...')
            query_idx = t
            query_size = args.tpch_size[np.random.randint(0, len(args.tpch_size))]

        job_dag, root = load_job(resource_limit, feature_dim, resource_dim, args.job_folder,
                                 query_size, query_idx, args.tpch_num, offset)
        offset += len(job_dag.nodes())
        graphs.append((query_size, query_idx))
        job_dags.append(job_dag)
        roots.extend(root)
    return job_dags, roots, graphs


def generate_tpch_jobs(resource_limit=600.0, feature_dim=2, resource_dim=1, num_init_dags=5):
    args = Args(feature_dim=feature_dim, resource_dim=resource_dim,
                num_init_dags=num_init_dags)
    job_dags, roots, offsets, graphs = [], [], [], []
    offset = 1
    tpchs = np.random.choice(args.tpch_num, size=num_init_dags, replace=True)
    for t in tpchs:
        offsets.append(offset)
        # generate query
        query_idx = str(t + 1)
        # query_idx = str(random.randint(0, args.tpch_num - 1) + 1)
        query_size = args.tpch_size[random.randint(0, len(args.tpch_size) - 1)]
        job_dag, root = load_job(resource_limit, feature_dim, resource_dim,
                                 args.job_folder, query_size, query_idx, args.tpch_num,
                                 offset)
        offset += len(job_dag.nodes())
        graphs.append((query_size, query_idx))
        job_dags.append(job_dag)
        roots.extend(root)
    return job_dags, roots, graphs


def add_graph_features(graph, dag_graph):
    path_to_leaf_scores = dag_graph.longest_path_to_any_leaf(
        graph, normalize=True)
    # nodes
    node_updates = []
    for node, data in graph.nodes(data=True):
        new_data = deepcopy(data)
        features = new_data['features']
        new_data['features'].append(features[0] / features[1])
        new_data['features'].append(path_to_leaf_scores[node])
        node_updates.append((node, new_data))
    # edges
    edge_updates = []
    for u, v, data in graph.edges(data=True):
        new_data = deepcopy(data)
        new_data['features'].append(0.0)
        edge_updates.append((u, v, new_data))
    graph.update(edges=edge_updates, nodes=node_updates)
    # global
    global_features = deepcopy(graph.graph)
    global_features['features'].append(0.0)
    graph.graph.update(global_features)
    return graph


def load_tpch_tuples(num_graphs, tid, dag_graph,
                     num_init_dags,
                     raw_node_feature_dim,
                     resource_dim, resource_limit,
                     add_graph_features,
                     scheduler_type
                     ):
    tuples = []
    selected_graphs = []
    for dag_id in range(num_graphs):
        if tid is None:
            dags, roots, graphs = generate_tpch_jobs(
                feature_dim=raw_node_feature_dim, resource_dim=resource_dim,
                num_init_dags=num_init_dags)
        else:
            dags, roots, graphs = load_tpch_jobs(
                resource_limit=resource_limit,
                feature_dim=raw_node_feature_dim, resource_dim=resource_dim,
                num_init_dags=num_init_dags, tid=tid, dag_id=dag_id)

        dummy_features = [0.0] * raw_node_feature_dim
        merged_dag = nx.DiGraph()
        merged_dag.add_node(0, features=dummy_features)
        merged_dag.graph["features"] = dummy_features

        for dag in dags:
            merged_dag.add_nodes_from(dag.nodes(data=True))
            merged_dag.add_edges_from(dag.edges(data=True))
        for root in roots:
            merged_dag.add_edge(root, 0, features=dummy_features)
        if add_graph_features:
            merged_dag = add_graph_features(merged_dag)
        selected_graphs.append((graphs, len(merged_dag.nodes()) - 1))
        resource_list = []
        for i in range(resource_dim):
            resource_list.append([])
        for node, data in merged_dag.nodes(data=True):
            for i in range(resource_dim):
                resource_list[i].append(data['features'][1 + i])
        resource_dist = [(round(np.min(resource_list[i]), 5),
                          round(np.mean(resource_list[i]), 5),
                          round(np.max(resource_list[i]), 5))
                         for i in range(resource_dim)]
        sizes = [len(dag.nodes()) for dag in dags]
        sft = dag_graph.makespan_time(merged_dag, scheduler_type)

        # sfs, cps, ts = -1, -1, -1
        sfs = dag_graph.shortest_first_scheduling(merged_dag)
        cps = dag_graph.critical_path_scheduling(merged_dag)
        ts = dag_graph.tetris_scheduling(merged_dag)
        print('graphs', sizes,
              'nodes', len(merged_dag.nodes()),
              'dags', graphs,
              'sft', round(sft, 6),
              'shortest_first', round(sfs, 6),
              'critical_path', round(cps, 6),
              'tetris', round(ts, 6),
              'resource', resource_dist,
              #'resource', [sorted(l) for l in resource_list]
              )
        tuples.append((merged_dag, sft, graphs,
                       {'shortest_first': sfs,
                        'critical_path': cps,
                        'tetris': ts}))
        # print(merged_dag.nodes(data=True))
    avg_nodes = np.mean([t[1] for t in selected_graphs])
    avg_sfs = np.mean([t[3]['shortest_first'] for t in tuples])
    std_sfs = np.std([t[3]['shortest_first'] for t in tuples])
    avg_cps = np.mean([t[3]['critical_path'] for t in tuples])
    std_cps = np.std([t[3]['critical_path'] for t in tuples])
    avg_ts = np.mean([t[3]['tetris'] for t in tuples])
    std_ts = np.std([t[3]['tetris'] for t in tuples])
    print(f'avg_nodes {avg_nodes:.4f} '
          f'shortest_first mean={avg_sfs:.4f} std={std_sfs:.4f} '
          f'critical_path mean={avg_cps:.4f} std={std_cps:.4f} '
          f'tetris mean={avg_ts:.4f} std={std_ts:.4f} '
          f'selected_graphs {selected_graphs}')
    return tuples
